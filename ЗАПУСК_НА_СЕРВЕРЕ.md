# 🚀 ЗАПУСК НА СЕРВЕРЕ 85.92.110.173

## Вариант 1: Автоматический деплой (РЕКОМЕНДУЕТСЯ)

Запустите этот скрипт **с вашего компьютера**:

```bash
cd /tmp/mydoc-loyalty
./remote-deploy.sh
```

Скрипт автоматически:
- ✅ Скопирует проект на сервер
- ✅ Установит Docker и Docker Compose
- ✅ Получит SSL сертификат
- ✅ Создаст .env с безопасными паролями
- ✅ Запустит все сервисы
- ✅ Инициализирует БД тестовыми данными
- ✅ Настроит автообновление SSL и backup

---

## Вариант 2: Ручной деплой

Если автоматический скрипт не сработает, выполните вручную:

### Шаг 1: Скопируйте проект на сервер

```bash
rsync -avz /tmp/mydoc-loyalty/ root@85.92.110.173:/var/www/mydoc-loyalty/
```

### Шаг 2: Подключитесь к серверу

```bash
ssh root@85.92.110.173
```

### Шаг 3: Установите Docker

```bash
curl -fsSL https://get.docker.com | sh
apt-get install -y docker-compose certbot
```

### Шаг 4: Получите SSL сертификат

```bash
certbot certonly --standalone -d it-mydoc.ru \
  --agree-tos --non-interactive --email admin@it-mydoc.ru

mkdir -p /var/www/mydoc-loyalty/nginx/ssl
cp /etc/letsencrypt/live/it-mydoc.ru/*.pem /var/www/mydoc-loyalty/nginx/ssl/
```

### Шаг 5: Создайте .env файл

```bash
cd /var/www/mydoc-loyalty

cat > .env << 'EOF'
DB_PASSWORD=MyDoc2025SecurePassword!
JWT_SECRET=$(openssl rand -hex 32)
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
DOMAIN=it-mydoc.ru
BITRIX_API_URL=
BITRIX_WEBHOOK=
ONEC_API_URL=
ONEC_USERNAME=
ONEC_PASSWORD=
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMS_API_KEY=
DEBUG=False
ENVIRONMENT=production
EOF

chmod 600 .env
```

### Шаг 6: Запустите сервисы

```bash
cd /var/www/mydoc-loyalty
chmod +x deploy.sh
./deploy.sh
```

---

## Проверка работы

После запуска проверьте:

```bash
# Статус контейнеров
docker-compose ps

# Логи
docker-compose logs -f backend

# Health check
curl https://it-mydoc.ru/api/health
```

---

## Доступ к сервисам

- **Frontend:** https://it-mydoc.ru
- **Admin Panel:** https://it-mydoc.ru/admin
- **API Docs:** https://it-mydoc.ru/api/docs

---

## Тестовые данные

| Роль | Email | Пароль |
|------|-------|--------|
| Админ | admin@it-mydoc.ru | admin123 |
| Кассир | cashier@it-mydoc.ru | cashier123 |
| Пациент | patient@it-mydoc.ru | patient123 |

⚠️ **Смените пароли после первого входа!**

---

## Устранение проблем

### Ошибка SSL
```bash
certbot renew --force-renewal
cp /etc/letsencrypt/live/it-mydoc.ru/*.pem /var/www/mydoc-loyalty/nginx/ssl/
docker-compose restart nginx
```

### Контейнер не запускается
```bash
docker-compose logs backend
docker-compose down
docker-compose up -d --build
```

### БД не доступна
```bash
docker-compose restart postgres
docker-compose exec postgres pg_isready
```

---

## 🎉 Готово!

После успешного запуска откройте https://it-mydoc.ru в браузере!
